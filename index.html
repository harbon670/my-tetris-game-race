<!DOCTYPE html>
<html>
<head>
    <title>Retro Racer Touch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { background: #000; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; font-family: monospace; }
        #game-container { position: relative; width: 300px; height: 500px; }
        canvas { background: #050505; border: 2px solid #333; display: block; }
        #ui-top { position: absolute; top: 10px; left: 0; width: 100%; display: flex; justify-content: space-around; align-items: center; pointer-events: none; }
        #score { color: #0ff; font-size: 22px; text-shadow: 2px 2px #000; }
        #pause-btn { background: rgba(255,255,255,0.1); border: 1px solid #0ff; color: #0ff; padding: 5px 15px; pointer-events: auto; cursor: pointer; border-radius: 4px; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; flex-direction: column; align-items: center; justify-content: center; color: #fff; pointer-events: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-top">
        <div id="score">0000</div>
        <button id="pause-btn">ПАУЗА</button>
    </div>
    <canvas id="gameCanvas" width="300" height="500"></canvas>
    <div id="pause-overlay" class="overlay"><h1 style="color:#0ff">ПАУЗА</h1><p>ТАП ДЛЯ ПРОДОЛЖЕНИЯ</p></div>
    <div id="death-overlay" class="overlay"><h1 style="color:#f05">АВАРИЯ!</h1><p>ТАП ДЛЯ РЕСТАРТА</p></div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const pauseBtn = document.getElementById('pause-btn');
    const pauseOverlay = document.getElementById('pause-overlay');
    const deathOverlay = document.getElementById('death-overlay');

    const BLOCK_SIZE = 15, LANE_LEFT = 6, LANE_RIGHT = 14;
    let score = 0, gameSpeed = 1.0, targetSpeed = 1.0;
    let gameOver = false, isPaused = false;
    let playerX = LANE_LEFT, targetX = LANE_LEFT;
    let enemies = [], particles = [], lastSpawn = 0;

    const car = [[0,1,0],[1,1,1],[0,1,0],[1,0,1]];
    const truck = [[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,0,1]];

    // Управление
    const handleInput = (e) => {
        if (e.target === pauseBtn) { togglePause(); return; }
        if (gameOver) { resetGame(); return; }
        if (isPaused) { togglePause(); return; }

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const rect = canvas.getBoundingClientRect();
        const xRel = clientX - rect.left;
        targetX = (xRel < rect.width / 2) ? LANE_LEFT : LANE_RIGHT;
    };

    function togglePause() {
        isPaused = !isPaused;
        pauseOverlay.style.display = isPaused ? 'flex' : 'none';
    }

    window.addEventListener('touchstart', handleInput);
    window.addEventListener('mousedown', handleInput);

    function drawEntity(gridX, gridY, matrix, color) {
        ctx.fillStyle = color;
        matrix.forEach((row, dy) => row.forEach((cell, dx) => {
            if (cell) ctx.fillRect((gridX + dx) * BLOCK_SIZE, (gridY + dy) * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
        }));
    }

    function resetGame() {
        score = 0; gameSpeed = 1.0; targetSpeed = 1.0; 
        gameOver = false; isPaused = false;
        enemies = []; particles = []; playerX = targetX = LANE_LEFT;
        deathOverlay.style.display = 'none';
        scoreEl.innerText = "0000";
    }

    function loop() {
        if (!gameOver && !isPaused) {
            ctx.clearRect(0, 0, 300, 500);
            gameSpeed += (targetSpeed - gameSpeed) * 0.005;

            // Разметка
            ctx.strokeStyle = "#222"; ctx.setLineDash([20, 20]);
            ctx.lineDashOffset = -(Date.now() / (15 / gameSpeed));
            ctx.beginPath(); ctx.moveTo(150, 0); ctx.lineTo(150, 500); ctx.stroke();

            playerX += (targetX - playerX) * 0.2;
            drawEntity(playerX, 25, car, "#0ff");

            let now = Date.now();
            if (now - lastSpawn > 1400/gameSpeed && (enemies.length === 0 || enemies[enemies.length-1].y > 11)) {
                let lastX = enemies.length > 0 ? enemies[enemies.length-1].x : LANE_LEFT;
                enemies.push({ x: lastX === LANE_LEFT ? LANE_RIGHT : LANE_LEFT, y: -6, 
                              type: Math.random() < 0.2 ? 'truck' : 'car', color: Math.random() < 0.3 ? "#fa0" : "#f05" });
                lastSpawn = now;
            }

            for (let i = enemies.length - 1; i >= 0; i--) {
                let e = enemies[i], m = e.type === 'truck' ? truck : car;
                e.y += gameSpeed * 0.16;
                drawEntity(e.x, e.y, m, e.color);

                if (!(playerX+1.8 < e.x || playerX > e.x+1.8 || 25+3 < e.y || 25 > e.y+m.length)) {
                    gameOver = true;
                    deathOverlay.style.display = 'flex';
                }

                if (e.y > 35) {
                    enemies.splice(i, 1);
                    score += 10;
                    scoreEl.innerText = score.toString().padStart(4, '0');
                    if (score % 100 === 0) targetSpeed += 0.15;
                }
            }
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
