<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro Turbo Drift</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: none; }
        body { background: #111; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Comic Sans MS', cursive, sans-serif; }
        #game-wrapper { position: relative; width: 280px; height: 500px; border: 4px solid #555; background: #94a800; } /* Цвет экрана как в Тетрисе */
        canvas { display: block; width: 100%; height: 100%; }
        #top-bar { position: absolute; top: 0; left: 0; width: 100%; padding: 10px; display: flex; justify-content: space-between; z-index: 10; pointer-events: none; }
        #score-val { color: #000; font-size: 24px; font-weight: bold; }
        #pause-btn { background: #000; color: #94a800; border: none; padding: 5px 10px; cursor: pointer; pointer-events: auto; font-family: inherit; }
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; flex-direction: column; align-items: center; justify-content: center; color: #fff; z-index: 20; text-align: center; padding: 20px; }
        #funny-phrase { color: #f05; font-size: 20px; margin-bottom: 20px; font-weight: bold; }
        .btn-restart { border: 2px solid #fff; padding: 10px 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="top-bar">
        <div id="score-val">0000</div>
        <button id="pause-btn" onclick="togglePause(event)">ПАУЗА</button>
    </div>
    <canvas id="game"></canvas>
    
    <div id="pause-screen" class="screen" onclick="togglePause()"><h1>ПАУЗА</h1><p>Тапни для старта</p></div>
    <div id="dead-screen" class="screen" onclick="reset()">
        <div id="funny-phrase"></div>
        <p id="final-score"></p>
        <div class="btn-restart">РЕСТАРТ</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('score-val');
    const deadScreen = document.getElementById('dead-screen');
    const phraseEl = document.getElementById('funny-phrase');

    canvas.width = 280; canvas.height = 500;
    const B = 16, L_LEFT = 3, L_RIGHT = 11;
    let score = 0, speed = 1.0, isDead = false, isPaused = false;
    let px = L_LEFT, tx = L_LEFT, enemies = [], lastSpawn = 0, offset = 0;

    const phrases = ["Права в карты выиграл?", "Столб дорогу перебегал!", "Мама, меня фура задавила!", "Тише будь", "Тормоза придумали клоуны!", "Красиво летел, но недолго", "Не гоняйте пацаны", "Зато подрифтил!", "Минус одна тачка в кредит"];
    const car = [[0,1,0],[1,1,1],[0,1,0],[1,0,1]];

    // ПЛАВНЫЙ СЕНСОР: Отслеживаем движение
    function moveHandler(e) {
        if (isDead || isPaused) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const relativeX = clientX - rect.left;
        tx = (relativeX < rect.width / 2) ? L_LEFT : L_RIGHT;
    }

    window.addEventListener('touchstart', moveHandler, {passive: false});
    window.addEventListener('touchmove', moveHandler, {passive: false});
    window.addEventListener('mousedown', moveHandler);
    window.addEventListener('mousemove', (e) => { if(e.buttons > 0) moveHandler(e); });

    function togglePause(e) { if(e) e.stopPropagation(); isPaused = !isPaused; document.getElementById('pause-screen').style.display = isPaused ? 'flex' : 'none'; }

    function reset() {
        score = 0; speed = 1.0; isDead = false; isPaused = false;
        enemies = []; px = tx = L_LEFT;
        deadScreen.style.display = 'none';
        scoreVal.innerText = "0000";
    }

    function draw(x, y, m, color) {
        ctx.fillStyle = color;
        m.forEach((row, dy) => row.forEach((val, dx) => {
            if (val) ctx.fillRect((x + dx) * B, (y + dy) * B, B - 1, B - 1);
        }));
    }

    function update() {
        if (!isPaused) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Шашечные бордюры
            offset = (offset + speed * 3) % (B * 2);
            for (let y = -B*2; y < canvas.height; y += B) {
                let isDark = Math.floor((y + offset) / B) % 2 === 0;
                ctx.fillStyle = isDark ? "#000" : "#7c8c00";
                ctx.fillRect(0, y, B, B); // Левый
                ctx.fillRect(canvas.width - B, y, B, B); // Правый
            }

            if (!isDead) {
                px += (tx - px) * 0.3; // Плавное скольжение
                draw(px, 24, car, "#000");

                let now = Date.now();
                if (now - lastSpawn > 1100/speed) {
                    enemies.push({ x: Math.random() > 0.5 ? L_LEFT : L_RIGHT, y: -5 });
                    lastSpawn = now;
                }
            }

            for (let i = enemies.length - 1; i >= 0; i--) {
                let e = enemies[i];
                if (!isDead) e.y += speed * 0.22;
                draw(e.x, e.y, car, "#000");

                if (!isDead && Math.abs(px - e.x) < 2.5 && Math.abs(24 - e.y) < 3.8) {
                    isDead = true;
                    phraseEl.innerText = phrases[Math.floor(Math.random()*phrases.length)];
                    document.getElementById('final-score').innerText = "СЧЕТ: " + score;
                    deadScreen.style.display = 'flex';
                }

                if (e.y > 35) {
                    enemies.splice(i, 1);
                    score += 10;
                    scoreVal.innerText = score.toString().padStart(4, '0');
                    speed += 0.04;
                }
            }
        }
        requestAnimationFrame(update);
    }
    update();
</script>
</body>
</html>
