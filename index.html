<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Epic Fail Racer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body { background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; color: #fff; font-family: 'Comic Sans MS', cursive; overflow: hidden; touch-action: none; }
    #ui { text-align: center; margin-bottom: 10px; cursor: pointer; background: #222; padding: 10px 20px; border-radius: 15px; border: 3px solid #ff0055; box-shadow: 0 0 20px #ff0055; transition: transform 0.1s; }
    #ui:active { transform: scale(0.95); }
    #score { font-size: 24px; color: #0ff; margin: 0; font-weight: bold; }
    canvas { border: 5px solid #333; background: #050505; max-height: 70vh; box-shadow: 0 0 30px rgba(255,0,85,0.3); }
    .status { font-size: 10px; color: #ff0055; font-weight: bold; }
  </style>
</head>
<body>

  <div id="ui" onclick="resetGame()">
    <p id="score">SCORE: 0</p>
    <div class="status">–†–ï–°–¢–ê–†–¢ –î–õ–Ø –ù–£–ë–û–í</div>
  </div>
  <canvas id="game" width="300" height="540"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');

    const grid = 30;
    const LANE_LEFT = 1.5;
    const LANE_RIGHT = 5.5;

    let score = 0;
    let gameSpeed = 4;
    let gameOver = false;
    let playerX = LANE_LEFT;
    let targetX = LANE_LEFT;
    let enemies = [];
    let particles = [];
    let shake = 0;
    let endPhrase = "";

    const phrases = [
      "–ü–†–ê–í–ê –í –ö–£–ü–õ–ï–ù–ù–û–ú –¢–û–†–¢–ï? üéÇ",
      "–°–¢–û–õ–ë –ë–´–õ –ú–ê–ì–ù–ò–¢–ù–´–ú! üß≤",
      "–¢–´ –ö–£–î–ê –ü–†–Å–®–¨, –ö–ê–°–ê–¢–ò–ö? üëÅÔ∏èüëÑüëÅÔ∏è",
      "–ê –¢–û–†–ú–û–ó –°–õ–ï–í–ê, –ï–°–õ–ò –ß–¢–û...",
      "–ú–ò–ù–£–° –ü–ê–ü–ò–ù–ê –ú–ê–®–ò–ù–ê üìâ",
      "–û–õ–ï–ì, –¢–´ –ì–î–ï –¢–ê–ö –ï–ó–î–ò–¢–¨ –£–ß–ò–õ–°–Ø?!",
      "–ú–ê–ú–ê –ê–ú–ê –ö–†–ò–ú–ò–ù–ê–õ... –û–ô üöì",
      "–ü–ï–†–ï–ü–£–¢–ê–õ –ü–ï–î–ê–õ–ò, –î–ê? üëã",
      "–ì–†–ê–§–ò–ö–ê ‚Äî –¢–û–ü, –í–û–î–ò–¢–ï–õ–¨ ‚Äî –ü–û–ü",
      "–ù–£ –í–°–Å, –ü–†–ò–ï–•–ê–õ–ò. –í–´–•–û–î–ò."
    ];

    const carMatrix = [[0,1,0],[1,1,1],[0,1,0],[1,0,1]];

    function createExplosion(x, y) {
      for(let i=0; i<30; i++) {
        particles.push({
          x: (x + 1) * grid,
          y: (y + 2) * grid,
          vx: (Math.random() - 0.5) * 15,
          vy: (Math.random() - 0.5) * 15,
          life: 1.0,
          color: Math.random() > 0.5 ? '#ff0055' : '#0ff'
        });
      }
    }

    function drawCar(x, y, color) {
      ctx.fillStyle = color;
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 3; c++) {
          if (carMatrix[r][c]) {
            ctx.fillRect((x + c) * grid, (y + r) * grid, grid - 3, grid - 3);
          }
        }
      }
    }

    function checkCollision(ex, ey) {
      return !(targetX + 2 < ex || targetX > ex + 2 || 14 + 3 < ey || 14 > ey + 3.5);
    }

    function resetGame() {
      if (!gameOver) return;
      score = 0; gameSpeed = 4; enemies = []; particles = []; targetX = LANE_LEFT; playerX = LANE_LEFT;
      gameOver = false; shake = 0;
      scoreEl.innerText = "SCORE: 0";
      loop();
    }

    window.addEventListener('pointerdown', e => {
      if (gameOver) return;
      targetX = (e.clientX < window.innerWidth / 2) ? LANE_LEFT : LANE_RIGHT;
      if (navigator.vibrate) navigator.vibrate(10);
    });

    function loop() {
      if (gameOver) return;
      requestAnimationFrame(loop);

      // –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ —ç–∫—Ä–∞–Ω–∞
      ctx.save();
      if (shake > 0) {
        ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
        shake *= 0.9;
      }

      ctx.fillStyle = "rgba(10, 10, 10, 0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // –î–æ—Ä–æ–≥–∞
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 2;
      ctx.setLineDash([20, 20]);
      ctx.lineDashOffset = -(Date.now() / 10);
      ctx.beginPath();
      ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height);
      ctx.stroke();

      playerX += (targetX - playerX) * 0.25;
      drawCar(playerX, 14, "#0ff");

      if (Math.random() < 0.02) {
        enemies.push({ x: Math.random() > 0.5 ? LANE_LEFT : LANE_RIGHT, y: -5 });
      }

      enemies.forEach((e, i) => {
        e.y += gameSpeed / 10;
        drawCar(e.x, e.y, "#ff0055");
        
        if (checkCollision(e.x, e.y)) {
          gameOver = true;
          shake = 20;
          createExplosion(playerX, 14);
          endPhrase = phrases[Math.floor(Math.random() * phrases.length)];
          if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
        }

        if (e.y > 20) {
          enemies.splice(i, 1);
          score += 10;
          scoreEl.innerText = "SCORE: " + score;
          gameSpeed += 0.05;
        }
      });

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü –≤–∑—Ä—ã–≤–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x, p.y, 5, 5);
        if (p.life <= 0) particles.splice(i, 1);
      });
      ctx.globalAlpha = 1;

      if (gameOver) {
        setTimeout(drawGameOver, 100);
      }
      ctx.restore();
    }

    function drawGameOver() {
      ctx.fillStyle = "rgba(0,0,0,0.8)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.fillStyle = "#fff";
      ctx.font = "bold 22px sans-serif";
      ctx.textAlign = "center";
      
      // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç —Å –æ–±–≤–æ–¥–∫–æ–π
      ctx.strokeStyle = "#ff0055";
      ctx.lineWidth = 4;
      ctx.strokeText(endPhrase, canvas.width / 2, canvas.height / 2);
      ctx.fillText(endPhrase, canvas.width / 2, canvas.height / 2);
      
      ctx.font = "12px sans-serif";
      ctx.fillStyle = "#0ff";
      ctx.fillText("–¢–´ –ù–ê–ë–†–ê–õ: " + score + " (–ü–û–ó–û–†!)", canvas.width / 2, canvas.height / 2 + 40);
    }

    loop();
  </script>
</body>
</html>
