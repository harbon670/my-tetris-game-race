<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Epic Fail Racer v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body { background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; color: #fff; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; }
    #ui { text-align: center; margin-bottom: 10px; cursor: pointer; background: #1a1a1a; padding: 10px; border-radius: 15px; border: 3px solid #0ff; box-shadow: 0 0 15px #0ff; width: 280px; user-select: none; }
    #score { font-size: 20px; color: #fff; margin: 0; font-weight: bold; }
    #best { font-size: 14px; color: #ff0055; margin: 0; }
    canvas { border: 5px solid #333; background: #050505; max-height: 75vh; max-width: 95vw; touch-action: none; }
    .status { font-size: 10px; color: #aaa; margin-top: 5px; }
  </style>
</head>
<body>

  <div id="ui" onclick="resetGame()">
    <p id="score">SCORE: 0</p>
    <p id="best">BEST: 0</p>
    <div class="status">–ö–õ–ò–ö–ê–ô –ü–û –ü–û–õ–û–°–ê–ú | –¢–´–ö –°–Æ–î–ê –î–õ–Ø –†–ï–°–¢–ê–†–¢–ê</div>
  </div>
  <canvas id="game" width="360" height="540"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');

    const grid = 30;
    // –¢–†–ò –ü–û–õ–û–°–´
    const LANES = [1, 4.5, 8]; 
    
    let score = 0;
    let highScore = localStorage.getItem('failRacerBest') || 0;
    let gameSpeed = 1.2; 
    let gameOver = false;
    let playerX = LANES[1];
    let targetX = LANES[1];
    let enemies = [];
    let particles = [];
    let shake = 0;
    let endPhrase = "";

    bestEl.innerText = "BEST: " + highScore;

    const phrases = ["–ü–†–ê–í–ê –í –ö–£–ü–õ–ï–ù–ù–û–ú|–¢–û–†–¢–ï? üéÇ", "–°–¢–û–õ–ë –ë–´–õ|–ú–ê–ì–ù–ò–¢–ù–´–ú! üß≤", "–¢–´ –ö–£–î–ê –ü–†–Å–®–¨? üëÅÔ∏è", "–ú–ò–ù–£–° –ü–ê–ü–ò–ù–ê|–ú–ê–®–ò–ù–ê üìâ", "–û–õ–ï–ì, –¢–´ –ì–î–ï –¢–ê–ö|–ï–ó–î–ò–¢–¨ –£–ß–ò–õ–°–Ø?!", "–ü–ï–†–ï–ü–£–¢–ê–õ –ü–ï–î–ê–õ–ò,|–î–ê? üëã"];
    const carMatrix = [[0, 1, 0], [1, 1, 1], [0, 1, 0], [1, 0, 1]];

    function createExplosion(x, y) {
      for(let i=0; i<25; i++) {
        particles.push({
          x: (x + 1) * grid, y: (y + 2) * grid,
          vx: (Math.random() - 0.5) * 15, vy: (Math.random() - 0.5) * 15,
          life: 1.0, color: Math.random() > 0.5 ? '#ff0055' : '#0ff'
        });
      }
    }

    function drawCar(x, y, color) {
      ctx.fillStyle = color;
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 3; c++) {
          if (carMatrix[r][c]) {
            ctx.fillRect((x + c) * grid, (y + r) * grid, grid - 3, grid - 3);
          }
        }
      }
    }

    function checkCollision(ex, ey) {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–∏—é playerX
      return !(playerX + 2.2 < ex || playerX > ex + 2.2 || 14 + 3.5 < ey || 14 > ey + 3.5);
    }

    function resetGame() {
      if (!gameOver) return;
      score = 0; gameSpeed = 1.2; enemies = []; particles = []; 
      targetX = LANES[1]; playerX = LANES[1];
      gameOver = false; shake = 0;
      scoreEl.innerText = "SCORE: 0";
    }

    window.addEventListener('pointerdown', e => {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const ratio = clickX / rect.width;
      
      // –î–µ–ª–∏–º —ç–∫—Ä–∞–Ω –Ω–∞ 3 –∑–æ–Ω—ã –¥–ª—è –∫–ª–∏–∫–∞
      if (ratio < 0.33) targetX = LANES[0];
      else if (ratio < 0.66) targetX = LANES[1];
      else targetX = LANES[2];

      if (navigator.vibrate) navigator.vibrate(15);
    });

    function loop() {
      requestAnimationFrame(loop);
      if (gameOver) { drawGameOver(); return; }

      ctx.save();
      if (shake > 0) {
        ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
        shake *= 0.9;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // –†–∞–∑–º–µ—Ç–∫–∞ (2 –ª–∏–Ω–∏–∏)
      ctx.strokeStyle = "#333";
      ctx.setLineDash([30, 30]);
      ctx.lineDashOffset = -(Date.now() / 15);
      [canvas.width/3, canvas.width*2/3].forEach(x => {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
      });

      playerX += (targetX - playerX) * 0.15; 
      drawCar(playerX, 14, "#0ff");

      // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
      if (Math.random() < 0.02) {
        // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–ª–æ—Å—É —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ä–∞–∑—É
        const freeLane = Math.floor(Math.random() * 3);
        const spawnLanes = LANES.filter((_, i) => i !== freeLane);
        // –°–ø–∞–≤–Ω–∏–º 1 –∏–ª–∏ 2 –º–∞—à–∏–Ω—ã, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ–µ–∑–¥
        const lane = spawnLanes[Math.floor(Math.random() * spawnLanes.length)];
        
        if (enemies.length === 0 || enemies[enemies.length-1].y > 6) {
           enemies.push({ x: lane, y: -5 });
        }
      }

      for (let i = enemies.length - 1; i >= 0; i--) {
        let e = enemies[i];
        e.y += gameSpeed / 8;
        drawCar(e.x, e.y, "#ff0055");
        
        if (checkCollision(e.x, e.y)) {
          gameOver = true;
          shake = 20;
          createExplosion(playerX, 14);
          endPhrase = phrases[Math.floor(Math.random() * phrases.length)];
          if (score > highScore) {
            highScore = score;
            localStorage.setItem('failRacerBest', highScore);
            bestEl.innerText = "BEST: " + highScore;
          }
        }

        if (e.y > 20) {
          enemies.splice(i, 1);
          score += 10;
          scoreEl.innerText = "SCORE: " + score;
          gameSpeed += 0.02;
        }
      }

      particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x, p.y, 5, 5);
        if (p.life <= 0) particles.splice(i, 1);
      });
      
      ctx.restore();
    }

    function drawGameOver() {
      ctx.fillStyle = "rgba(0,0,0,0.05)"; // –ü–ª–∞–≤–Ω–æ–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.textAlign = "center";
      const lines = endPhrase.split('|');
      ctx.font = "bold 22px sans-serif";
      lines.forEach((line, index) => {
        ctx.fillStyle = "#ff0055";
        ctx.fillText(line, canvas.width / 2, canvas.height / 2 + (index * 30));
      });
    }

    loop();
  </script>
</body>
</html>
